id: 54d53e2d-8010-4ed2-92aa-e9732f6c703e
name: DET-012 - Threat - XDR - Threat Activity Detected
version: 1.0.1
kind: Scheduled
description: >
  Create an incident for each high-severity (High) SecurityAlert raised by Microsoft security products,
  excluding Sentinel-generated alerts. One incident per vendor alert, with vendor link and identifiers.
severity: High
enabled: true
query: |
  let window = 1h;
  SecurityAlert
  | where TimeGenerated > ago(window)
  | where isnotempty(SystemAlertId)
  | where AlertSeverity =~ "High"
  // avoid counting Sentinel-generated analytics (handles Azure/Microsoft Sentinel variants)
  | where ProductName !contains "Sentinel" and ProviderName !contains "Sentinel"
  // de-duplicate in case the same vendor alert is updated during the window
  | summarize arg_max(TimeGenerated, *) by tostring(SystemAlertId)
  | project
      TimeGenerated,
      ProviderName,
      ProductName,
      AlertName,
      AlertSeverity,
      CompromisedEntity,
      SystemAlertId,
      AlertLink,
      Entities
queryFrequency: PT5M
queryPeriod: PT1H
triggerOperator: GreaterThan
triggerThreshold: 0
tactics:
  - Execution
  - CredentialAccess
  - DefenseEvasion
  - Discovery
  - InitialAccess
  - Persistence
  - PrivilegeEscalation
relevantTechniques:
  - T1059
  - T1078
  - T1562
  - T1087
  - T1566
  - T1098
  - T1068
suppressionEnabled: false
suppressionDuration: PT1H
eventGroupingSettings:
  aggregationKind: AlertPerResult
alertDetailsOverride:
  alertDisplayNameFormat: 'XDR High-Severity Security Alert: {{AlertName}} ({{ProviderName}} / {{ProductName}})'
  alertDescriptionFormat: >
    High severity alert raised by {{ProductName}} ({{ProviderName}}).
    Vendor link: {{AlertLink}} | SystemAlertId: {{SystemAlertId}}
customDetails:
  SystemAlertId: '{{SystemAlertId}}'
  ProviderName: '{{ProviderName}}'
  ProductName: '{{ProductName}}'
  AlertLink: '{{AlertLink}}'
entityMappings:
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: CompromisedEntity
incidentConfiguration:
  createIncident: true
  groupingConfiguration:
    enabled: false
