{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspaceResourceId": {
      "type": "string"
    },
    "ruleDisplayName": {
      "type": "string",
      "defaultValue": "Feed-Down: site-level Syslog gap (60m)"
    },
    "ruleId": {
      "type": "string",
      "defaultValue": "00000000-0000-0000-0000-000000000060"
    }
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
      "apiVersion": "2023-02-01-preview",
      "name": "[concat(split(parameters('workspaceResourceId'), '/')[8], '/Microsoft.SecurityInsights/', parameters('ruleId'))]",
      "properties": {
        "displayName": "[parameters('ruleDisplayName')]",
        "description": "Auto-generated by CIRT Handoff package.",
        "enabled": true,
        "severity": "Critical",
        "queryFrequency": "PT10M",
        "queryPeriod": "PT65M",
        "triggerOperator": "GreaterThan",
        "triggerThreshold": 0,
        "kind": "Scheduled",
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "suppressionEnabled": false,
        "suppressionDuration": "PT0H",
        "alertDetailsOverride": {
          "alertDisplayNameFormat": "Feed-Down: site {{Site}} Syslog gap (60m)",
          "alertDescriptionFormat": "DeviceType={{DeviceType}} | Site={{Site}} | LastSeen={{LastSeen}}"
        },
        "entityMappings": [
          {
            "entityType": "Host",
            "fieldMappings": [
              {
                "identifier": "HostName",
                "columnName": "DeviceName"
              }
            ]
          },
          {
            "entityType": "IP",
            "fieldMappings": [
              {
                "identifier": "Address",
                "columnName": "IP"
              }
            ]
          }
        ],
        "query": "[concat(base64ToString('Ci8vIFNUUklDVCBmZWVkLWRvd24gKDYwbSkgYnkgc2l0ZSwgbWFwcGluZzogU3lzbG9nLkNvbXB1dGVyID09IFdhdGNobGlzdFsnU2VudGluZWwgTG9va3VwJ10KbGV0IHdhdGNobGlzdE5hbWUgPSAnTmV0d29ya0RldmljZXNfV2F0Y2hsaXN0JzsKbGV0IGxvb2tiYWNrID0gNjVtOwpsZXQgdGhyZXNob2xkID0gNjBtOwpsZXQgbWluQ291bnQgPSAzOwpsZXQgbWluUGVyY2VudCA9IDAuNTsKbGV0IG5vd1V0YyA9IG5vdygpOwpsZXQgV0wgPSBfR2V0V2F0Y2hsaXN0KHdhdGNobGlzdE5hbWUpCnwgcHJvamVjdCBEZXZpY2VOYW1lUmF3ID0gdG9zdHJpbmcoWydTZW50aW5lbCBMb29rdXAnXSksCiAgICAgICAgICBJUCA9IHRvc3RyaW5nKFsnSVAgQWRkcmVzcyddKSwKICAgICAgICAgIERldmljZVR5cGUgPSB0b3N0cmluZyhbJ2RldmljZSB0eXBlJ10pLAogICAgICAgICAgU2l0ZSA9IHRvc3RyaW5nKFsnc2l0ZSddKSwKICAgICAgICAgIEVuYWJsZWRSYXcgPSB0b3N0cmluZyhbJ2VuYWJsZWQnXSksCiAgICAgICAgICBTdXBwcmVzc1VudGlsID0gdG9kYXRldGltZShbJ3N1cHByZXNzX3VudGlsJ10pCnwgZXh0ZW5kIERldmljZUtleSA9IHRvbG93ZXIodHJpbSgnICcsIERldmljZU5hbWVSYXcpKSwKICAgICAgICAgRW5hYmxlZCA9IGNhc2UodG91cHBlcihFbmFibGVkUmF3KSBpbiAoJ0ZBTFNFJywnMCcsJ05PJywnTicsJ0RJU0FCTEVEJyksIGZhbHNlLCB0cnVlKQp8IHdoZXJlIEVuYWJsZWQgPT0gdHJ1ZQp8IHdoZXJlIGlzbnVsbChTdXBwcmVzc1VudGlsKSBvciBTdXBwcmVzc1VudGlsIDwgbm93VXRjCnwgZXh0ZW5kIFNpdGUgPSBpaWYoaXNlbXB0eShTaXRlKSwgdG9zdHJpbmcoc3BsaXQoRGV2aWNlS2V5LCAnLScpWzBdKSwgU2l0ZSk7CmxldCBBY3RpdmUgPSBTeXNsb2cKfCB3aGVyZSBUaW1lR2VuZXJhdGVkID4gbm93VXRjIC0gbG9va2JhY2sKfCBleHRlbmQgQ29tcHV0ZXJLZXkgPSB0b2xvd2VyKHRyaW0oJyAnLCB0b3N0cmluZyhDb21wdXRlcikpKQp8IHN1bW1hcml6ZSBMYXN0U2VlbiA9IG1heChUaW1lR2VuZXJhdGVkKSBieSBDb21wdXRlcktleTsKbGV0IE1pc3NpbmdOb3cgPSBXTAp8IGpvaW4ga2luZD1sZWZ0b3V0ZXIgQWN0aXZlIG9uICRsZWZ0LkRldmljZUtleSA9PSAkcmlnaHQuQ29tcHV0ZXJLZXkKfCBleHRlbmQgTGFzdFNlZW5Db21iaW5lZCA9IExhc3RTZWVuCnwgZXh0ZW5kIE1pc3NpbmcgPSBpaWYoaXNudWxsKExhc3RTZWVuQ29tYmluZWQpIG9yIExhc3RTZWVuQ29tYmluZWQgPCBub3dVdGMgLSB0aHJlc2hvbGQsIDEsIDApCnwgd2hlcmUgTWlzc2luZyA9PSAxCnwgcHJvamVjdCBTaXRlLCBEZXZpY2VOYW1lID0gRGV2aWNlTmFtZVJhdywgRGV2aWNlVHlwZSwgSVAsIExhc3RTZWVuID0gTGFzdFNlZW5Db21iaW5lZDsKTWlzc2luZ05vdwp8IHN1bW1hcml6ZSBNaXNzaW5nQ291bnQgPSBjb3VudCgpLCBEZXZpY2VzID0gbWFrZV9zZXQoRGV2aWNlTmFtZSwgMTAwMCkgYnkgU2l0ZQp8IGpvaW4ga2luZD1pbm5lciAoV0wgfCBzdW1tYXJpemUgU2l0ZVRvdGFsID0gY291bnQoKSBieSBTaXRlKSBvbiBTaXRlCnwgZXh0ZW5kIE1pc3NpbmdQY3QgPSB0b2RvdWJsZShNaXNzaW5nQ291bnQpIC8gdG9kb3VibGUoU2l0ZVRvdGFsKQp8IHdoZXJlIE1pc3NpbmdDb3VudCA+PSBtaW5Db3VudCBvciBNaXNzaW5nUGN0ID49IG1pblBlcmNlbnQK'))]"
      }
    }
  ]
}